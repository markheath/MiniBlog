<post>
  <title>Converting MP3 to WAV with NAudio</title>
  <slug>converting-mp3-to-wav-with-naudio</slug>
  <author>Mark Heath</author>
  <pubDate>2010-05-13 07:26:00</pubDate>
  <lastModified>2010-05-13 07:26:00</lastModified>
  <content>&lt;p&gt;One of the more common support requests with &lt;a href="http://www.codeplex.com/naudio" target="_blank"&gt;NAudio&lt;/a&gt; is how to convert MP3 files to WAV. Here’s a simple function that will do just that:&lt;/p&gt;  &lt;pre class="brush: csharp;"&gt;public static void Mp3ToWav(string mp3File, string outputFile)
{
    using (Mp3FileReader reader = new Mp3FileReader(mp3File))
    {
        using (WaveStream pcmStream = WaveFormatConversionStream.CreatePcmStream(reader))
        {
            WaveFileWriter.CreateWaveFile(outputFile, pcmStream);
        }
    }
}&lt;/pre&gt;

&lt;p&gt;… and that’s all there is to it.&lt;/p&gt;

&lt;p&gt;Notes:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;There is no need to wrap pcmStream with a BlockAlignReductionStream since we are not repositioning the MP3 file, just reading it from start to finish.&lt;/li&gt;

  &lt;li&gt;It uses the ACM MP3 decoder that comes with Windows to decompress the MP3 data.&lt;/li&gt;

  &lt;li&gt;To be able to pass the MP3 data to the ACM converter we need to do some parsing of the MP3 file itself (specifically the MP3 frames and ID3 tags). Unfortunately, there are some MP3 files that NAudio cannot parse (notably the sample ones that come with Windows 7). My attempts at tracking down the cause of this problem have so far failed. (the basic issue is that after reading the ID3v2 tag, we don’t end up in the right place in the MP3 file to read a valid MP3Frame – see &lt;a title="http://naudio.codeplex.com/SourceControl/changeset/view/46381#7826" href="http://naudio.codeplex.com/SourceControl/changeset/view/46381#7826"&gt;MP3FileReader.cs&lt;/a&gt;). Please let me know if you think you have a solution to this.&lt;/li&gt;
&lt;/ol&gt;  </content>
  <ispublished>true</ispublished>
  <categories>
    <category>NAudio</category>
    <category>audio</category>
  </categories>
  <comments>
    <comment isAdmin="false" isApproved="true" id="48fc6bf9-2a9d-42cb-abb8-a843bb23ffd8">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website />
      <ip />
      <userAgent />
      <date>2010-05-13 12:48:37</date>
      <content>Hi ! Have you tested Mp3-Sharp to see if some errors are reproducible at the same stream offset ? I often come across MP3 files with a few weird frames, so I tend to just skip them instead of failing the entire conversion.&lt;br /&gt;&lt;br /&gt;http://robburke.net/mle/mp3sharp/&lt;br /&gt;&lt;br /&gt;Cheers, Dan</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="08d9225a-a4b7-4747-a727-051272d5327b">
      <author>Mark H</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/17900587357903273800</website>
      <ip />
      <userAgent />
      <date>2010-05-13 12:54:15</date>
      <content>I might have a go loading them with MP3Sharp, but I can&amp;#39;t use any of their code unfortunately since it is GPL</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="1245a08a-be7c-41c4-bbd8-051a0eef7716">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website />
      <ip />
      <userAgent />
      <date>2010-05-13 17:57:06</date>
      <content>The Windows 7 MP3 music clips fail because they have a wrong layer code in some headers. However you can safely skip them.&lt;br /&gt;&lt;br /&gt;Take a look at:&lt;br /&gt;&lt;br /&gt;Bitstream.cs&lt;br /&gt;nextFrame()&lt;br /&gt;read_header()&lt;br /&gt;isSyncMark()&lt;br /&gt;&amp;quot;INVALID LAYER DETECTED&amp;quot;&lt;br /&gt;==&amp;gt; SKIP :)</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="0f669ab7-a9ec-436b-bdf2-d21b367c1e92">
      <author>Joymon | ജോയ് മോന്‍ | जोय मोन | ஜோய் மோன்</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/12014569049635491702</website>
      <ip />
      <userAgent />
      <date>2010-05-17 16:40:15</date>
      <content>Do you have any idea to convert WAV to Mp3 in Silverlight?</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="5292ca0c-a6bc-4ad4-b80b-1b2bd7b40775">
      <author>Mark H</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/17900587357903273800</website>
      <ip />
      <userAgent />
      <date>2010-05-17 16:53:53</date>
      <content>@joymon - do you mean MP3 to WAV?</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="f4a070c6-e54d-4874-bf6c-b2b540589d11">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website />
      <ip />
      <userAgent />
      <date>2010-06-09 23:12:58</date>
      <content>Hi Mark,&lt;br /&gt;&lt;br /&gt;I&amp;#39;d like to convert WAV to MP3. I&amp;#39;ve downloaded NAudio from codeplex but I can only find an MP3FileReader - is there an equivalent of an MP3FileWriter?&lt;br /&gt;&lt;br /&gt;To make matters more complicated I&amp;#39;d like to perform the conversion on the fly. I have some recordings in WAV (from a phone system) and would like to convert them in realtime as they are downloaded. I have a solution working which automates lame, but because I need to convert the whole file before streaming it gives me an appreciable delay.&lt;br /&gt;&lt;br /&gt;Any advice you have would be much appreciated.&lt;br /&gt;&lt;br /&gt;Regards,&lt;br /&gt;&lt;br /&gt;Daniel</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="e2101bc8-cf82-440c-8e03-74da26c8bb9b">
      <author>Mark H</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/17900587357903273800</website>
      <ip />
      <userAgent />
      <date>2010-06-18 15:35:08</date>
      <content>I&amp;#39;m afraid NAudio cannot convert to MP3. Your best bet is to use LAME.exe</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="e0b05b34-63d8-4a72-b9f0-518e5834e26d">
      <author>Anton</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/01870348781368284888</website>
      <ip />
      <userAgent />
      <date>2010-07-15 13:49:34</date>
      <content>Hi Mark....&lt;br /&gt;&lt;br /&gt;I have been unable to find an email address to contact you directly, so I thought I would post my question here...&lt;br /&gt;&lt;br /&gt;I am looking for an audio component and was wondering if nAudio was able to acheive what I require.&lt;br /&gt;My requirements are as follows:&lt;br /&gt;&lt;br /&gt;    I have multiple audio tracks with nothing but music.&lt;br /&gt;    I have multiple recorded voice tracks no longer than 2-3 seconds each.&lt;br /&gt;    What I would like to do is &amp;quot;overlay&amp;quot; a voice track onto an audio&lt;br /&gt;track at a specified time and output the results to a single file.&lt;br /&gt;    E.g. Audio track is 2 minutes long, and I would like to insert&lt;br /&gt;the voice track at 23 seconds as well 1m 05 seconds and at 1m 40&lt;br /&gt;seconds.&lt;br /&gt;&lt;br /&gt;Can nAudio achieve this sort of task for me??&lt;br /&gt;I am using VB.Net and I would need to accomplish this through code (API)...&lt;br /&gt;&lt;br /&gt;Your assistance would be greatly appreciated.&lt;br /&gt;&lt;br /&gt;Anton</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="116356d1-de96-486f-afca-0c26a764473a">
      <author>ah</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/04784173564155635891</website>
      <ip />
      <userAgent />
      <date>2011-08-02 20:32:24</date>
      <content>Sorry I am late on this, I am new to NAudio (looks wicked btw).  When calling WaveFileWriter.CreateWaveFile, is there a way to get the progress of the decoding?</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="f931f2ac-8808-4400-81c4-d46245dea47e">
      <author>Mark H</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/17900587357903273800</website>
      <ip />
      <userAgent />
      <date>2011-08-09 14:27:23</date>
      <content>@ah - look at the source code for CreateWaveFile - it is just a helper method that reads from the source and writes to the WAV file in a simple loop. You can easily write it yourself with whatever progress indicators you want.</content>
    </comment>
  </comments>
</post>