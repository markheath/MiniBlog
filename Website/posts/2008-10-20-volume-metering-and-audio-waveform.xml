<post>
  <title>Volume Metering and Audio Waveform Display in NAudio</title>
  <slug>volume-metering-and-audio-waveform</slug>
  <author>Mark Heath</author>
  <pubDate>2008-10-20 22:18:00</pubDate>
  <lastModified>2011-07-03 16:12:01</lastModified>
  <content>&lt;p&gt;I spent a couple of hours this evening adding two features to &lt;a href="http://www.codeplex.com/naudio"&gt;NAudio&lt;/a&gt; that I have been meaning to add for a long time. They are two Windows Forms controls, one to display volume levels, and the other to display audio waveforms. They are still in a very raw state, and I will probably make some enhancements to their appearance as well as how they calculate their volume levels in the future, but they work pretty well for basic visualisation purposes. I'm also looking forward to creating their equivalents in WPF.&lt;/p&gt; &lt;p&gt;&lt;a href="/posts/files/volume-metering-and-audio-waveform-1.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="winforms-waveform" border="0" alt="winforms-waveform" src="/posts/files/volume-metering-and-audio-waveform-1.png" width="533" height="368"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;I've made a very short screencast to show them in action. Watch it here: &lt;a title="http://screencast.com/t/m13tSFGAG" href="http://screencast.com/t/m13tSFGAG"&gt;http://screencast.com/t/m13tSFGAG&lt;/a&gt;&lt;/p&gt;  </content>
  <ispublished>true</ispublished>
  <categories>
    <category>NAudio</category>
    <category>audio</category>
  </categories>
  <comments>
    <comment isAdmin="false" isApproved="true" id="91680e5b-70d4-4284-b773-f4a654ad6291">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website />
      <ip />
      <userAgent />
      <date>2009-03-20 15:52:00</date>
      <content>Great application! &lt;BR/&gt;&lt;BR/&gt;Can you display the complete waveform of the audio track in a control?</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="6a0b1b22-23d0-4418-89bc-e2bfe70d5c2b">
      <author>Mark H</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/17900587357903273800</website>
      <ip />
      <userAgent />
      <date>2009-03-20 16:18:00</date>
      <content>that's not a specific feature, although the code wouldn't be too hard to change to do it.&lt;BR/&gt;I'm hoping to add some better waveform drawing support in the future including some WPF rendering</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="eae77d74-244e-4ce1-a700-4f0276635390">
      <author>Iron Yuppie</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/10807988020305423467</website>
      <ip />
      <userAgent />
      <date>2009-05-13 22:58:00</date>
      <content>this really is cool... did you ever get the waveform working in SL?</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="32453a81-efcd-45b6-9fd1-aee1a78cb2cf">
      <author>Mark H</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/17900587357903273800</website>
      <ip />
      <userAgent />
      <date>2009-05-14 17:49:00</date>
      <content>I have WaveForm display working in WPF. We need to wait for Silverlight 3 before there is any point doing waveform display, as only in SL3 do we get access to the samples during playback.</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="f06ef020-b529-41eb-af4a-5f80456607ac">
      <author>splaxtek</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/00511152499028713418</website>
      <ip />
      <userAgent />
      <date>2009-12-26 22:01:37</date>
      <content>Hi Mark been looking to use your Volume meter but i can&amp;#39;t get them working. Tried also doing the ones with kaxaml but without success. Yours seems to be easier to use. But the thing is i need them to preview the input level before i start recording. can you please help me how i&amp;#39;m going to do it pls &lt;br /&gt;&lt;br /&gt;thanks</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="781ca31b-73b1-4c55-846a-b04770e50382">
      <author>Mark H</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/17900587357903273800</website>
      <ip />
      <userAgent />
      <date>2009-12-27 08:06:19</date>
      <content>hi Splaxtek,&lt;br /&gt;have a look at my &lt;a href="http://voicerecorder.codeplex.com" rel="nofollow"&gt;.NET Voice Recorder project&lt;/a&gt; to see how you preview volume with NAudio. It&amp;#39;s quite simple really, just start &amp;#39;recording&amp;#39; but only use the data you get to update the meter, don&amp;#39;t write it to a file.</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="d8c721c8-2904-461b-a567-7f3adf315f6d">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website />
      <ip />
      <userAgent />
      <date>2011-02-09 06:48:58</date>
      <content>Hi Mark!&lt;br /&gt;&lt;br /&gt;May I clarify that what you mean for your waveform painter is that the amplitude (I assume thats what it is painting) will never become negative? Because for waveforms, their shape when zoomed in on is usually an &amp;#39;up-down&amp;#39; shape from the middle (which when looked at normally will result in your waveform shape).&lt;br /&gt;&lt;br /&gt;So basically, what it does is, you read data from the WAV file, get a block from the data, and get and display the maximum amplitude or peak for that block. Is this right?&lt;br /&gt;&lt;br /&gt;Thanks!</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="05f35970-9b20-4bdd-a936-22f1ea06b4e7">
      <author>Mark H</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/17900587357903273800</website>
      <ip />
      <userAgent />
      <date>2011-02-21 10:11:50</date>
      <content>@anonymous, yes this makes a symetric waveform based on the absolute peak over the period aggregated.</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="f260c13b-56fd-41f5-9972-b09c078208e9">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website />
      <ip />
      <userAgent />
      <date>2011-03-07 10:03:11</date>
      <content>hi mark,&lt;br /&gt;may i ask, &amp;#39;have a look at my .NET Voice Recorder project to see how you preview volume with NAudio&amp;#39; as u stated above, i&amp;#39;ve seen them but i cant really get it. can u pls pinpoint out the functions for me? thanks a lot.</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="3a935a5e-1255-4aec-be26-3d9cb3c5e2cf">
      <author>ben</author>
      <email>noreply@blogger.com</email>
      <website />
      <ip />
      <userAgent />
      <date>2011-03-07 14:29:28</date>
      <content>private float lastPeak;&lt;br /&gt;&lt;br /&gt;void recorder_MaximumCalculated(object sender, MaxSampleEventArgs e)&lt;br /&gt;        {&lt;br /&gt;            lastPeak = Math.Max(e.MaxSample, Math.Abs(e.MinSample));&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public float CurrentInputLevel { get { return lastPeak * 100; } }&lt;br /&gt;&lt;br /&gt;void waveIn_DataAvailable(object sender, WaveInEventArgs e)&lt;br /&gt;        {&lt;br /&gt;            if (this.InvokeRequired)&lt;br /&gt;            {&lt;br /&gt;                this.BeginInvoke(new EventHandler(waveIn_DataAvailable), sender, e);&lt;br /&gt;            }&lt;br /&gt;            else&lt;br /&gt;            {&lt;br /&gt;                writer.WriteData(e.Buffer, 0, e.BytesRecorded);&lt;br /&gt;                int secondsRecorded = (int)(writer.Length / writer.WaveFormat.AverageBytesPerSecond);&lt;br /&gt;                waveformPainter2.AddMax(CurrentInputLevel);&lt;br /&gt;                if (secondsRecorded &amp;gt;= 30)&lt;br /&gt;                {&lt;br /&gt;                    StopRecording();&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;I&amp;#39;m wondering y this does not work?</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="1e36b683-895b-4fe2-af75-7b15dd088e33">
      <author>ben</author>
      <email>noreply@blogger.com</email>
      <website />
      <ip />
      <userAgent />
      <date>2011-03-07 14:29:36</date>
      <content>private float lastPeak;&lt;br /&gt;&lt;br /&gt;void recorder_MaximumCalculated(object sender, MaxSampleEventArgs e)&lt;br /&gt;        {&lt;br /&gt;            lastPeak = Math.Max(e.MaxSample, Math.Abs(e.MinSample));&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public float CurrentInputLevel { get { return lastPeak * 100; } }&lt;br /&gt;&lt;br /&gt;void waveIn_DataAvailable(object sender, WaveInEventArgs e)&lt;br /&gt;        {&lt;br /&gt;            if (this.InvokeRequired)&lt;br /&gt;            {&lt;br /&gt;                this.BeginInvoke(new EventHandler(waveIn_DataAvailable), sender, e);&lt;br /&gt;            }&lt;br /&gt;            else&lt;br /&gt;            {&lt;br /&gt;                writer.WriteData(e.Buffer, 0, e.BytesRecorded);&lt;br /&gt;                int secondsRecorded = (int)(writer.Length / writer.WaveFormat.AverageBytesPerSecond);&lt;br /&gt;                waveformPainter2.AddMax(CurrentInputLevel);&lt;br /&gt;                if (secondsRecorded &amp;gt;= 30)&lt;br /&gt;                {&lt;br /&gt;                    StopRecording();&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;I&amp;#39;m wondering y this does not work?</content>
    </comment>
  </comments>
</post>